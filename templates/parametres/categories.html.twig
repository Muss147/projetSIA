{% extends "admin/layout.html.twig" %}

{% block title %}Liste des clients{% endblock %}

{% block stylesheet %}
<link href="{{asset('assets/plugins/custom/datatables/datatables.bundle.css')}}" rel="stylesheet" type="text/css"/> 
{% endblock %}

{% block body %}
	<div
		class="content d-flex flex-column flex-column-fluid " id="kt_content">

		<!--begin::Toolbar-->
		<div
			class="toolbar d-flex flex-stack mb-3 mb-lg-5" id="kt_toolbar">
			<!--begin::Container-->
			<div
				id="kt_toolbar_container" class=" container-fluid  d-flex flex-stack flex-wrap">


				<!--begin::Page title-->
				<div
					class="page-title d-flex flex-column me-5 py-2">
					<!--begin::Title-->
					<h1 class="d-flex flex-column text-gray-900 fw-bold fs-3 mb-0">
						Catégories
					</h1>
					<!--end::Title-->

					<!--begin::Breadcrumb-->
					<ul
						class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 pt-1">
						<!--begin::Item-->
						<li class="breadcrumb-item text-muted">
							<a href="" class="text-muted text-hover-primary">
								Accueil
							</a>
						</li>
						<!--end::Item-->
						<!--begin::Item-->
						<li class="breadcrumb-item">
							<span class="bullet bg-gray-200 w-5px h-2px"></span>
						</li>
						<!--end::Item-->

						<!--begin::Item-->
						<li class="breadcrumb-item text-muted">
							Paramètres
						</li>
						<!--end::Item-->
						<!--begin::Item-->
						<li class="breadcrumb-item">
							<span class="bullet bg-gray-200 w-5px h-2px"></span>
						</li>
						<!--end::Item-->

						<!--begin::Item-->
						<li class="breadcrumb-item text-gray-900">
							Catégories
						</li>
						<!--end::Item-->

					</ul>
					<!--end::Breadcrumb-->
				</div>
				<!--end::Page title-->
				<!--begin::Actions-->
				{# <div
					class="d-flex align-items-center py-2">
					<!--begin::Wrapper-->
					<div
						class="me-4">
						<!--begin::Menu-->
						<a href="#" class="btn btn-sm btn-flex btn-light btn-active-primary fw-bold" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
							<i class="ki-duotone ki-filter fs-5 text-gray-500 me-1">
								<span class="path1"></span>
								<span class="path2"></span>
							</i>
							Filter
						</a>


						<!--begin::Menu 1-->
						<div
							class="menu menu-sub menu-sub-dropdown w-250px w-md-300px" data-kt-menu="true" id="kt_menu_68154244c317a">
							<!--begin::Header-->
							<div class="px-7 py-5">
								<div class="fs-5 text-gray-900 fw-bold">Filter Options</div>
							</div>
							<!--end::Header-->

							<!--begin::Menu separator-->
							<div class="separator border-gray-200"></div>
							<!--end::Menu separator-->


							<!--begin::Form-->
							<div
								class="px-7 py-5">
								<!--begin::Input group-->
								<div
									class="mb-10">
									<!--begin::Label-->
									<label class="form-label fw-semibold">Status:</label>
									<!--end::Label-->

									<!--begin::Input-->
									<div>
										<select class="form-select form-select-solid" multiple data-kt-select2="true" data-close-on-select="false" data-placeholder="Select option" data-dropdown-parent="#kt_menu_68154244c317a" data-allow-clear="true">
											<option></option>
											<option value="1">Approved</option>
											<option value="2">Pending</option>
											<option value="2">In Process</option>
											<option value="2">Rejected</option>
										</select>
									</div>
									<!--end::Input-->
								</div>
								<!--end::Input group-->

								<!--begin::Input group-->
								<div
									class="mb-10">
									<!--begin::Label-->
									<label class="form-label fw-semibold">Member Type:</label>
									<!--end::Label-->

									<!--begin::Options-->
									<div
										class="d-flex">
										<!--begin::Options-->
										<label class="form-check form-check-sm form-check-custom form-check-solid me-5">
											<input class="form-check-input" type="checkbox" value="1"/>
											<span class="form-check-label">
												Author
											</span>
										</label>
										<!--end::Options-->

										<!--begin::Options-->
										<label class="form-check form-check-sm form-check-custom form-check-solid">
											<input class="form-check-input" type="checkbox" value="2" checked="checked"/>
											<span class="form-check-label">
												Customer
											</span>
										</label>
										<!--end::Options-->
									</div>
									<!--end::Options-->
								</div>
								<!--end::Input group-->

								<!--begin::Input group-->
								<div
									class="mb-10">
									<!--begin::Label-->
									<label class="form-label fw-semibold">Notifications:</label>
									<!--end::Label-->

									<!--begin::Switch-->
									<div class="form-check form-switch form-switch-sm form-check-custom form-check-solid">
										<input class="form-check-input" type="checkbox" value="" name="notifications" checked/>
										<label class="form-check-label">
											Enabled
										</label>
									</div>
									<!--end::Switch-->
								</div>
								<!--end::Input group-->

								<!--begin::Actions-->
								<div class="d-flex justify-content-end">
									<button type="reset" class="btn btn-sm btn-light btn-active-light-primary me-2" data-kt-menu-dismiss="true">Reset</button>

									<button type="submit" class="btn btn-sm btn-primary" data-kt-menu-dismiss="true">Apply</button>
								</div>
								<!--end::Actions-->
							</div>
							<!--end::Form-->
						</div>
						<!--end::Menu 1-->
						<!--end::Menu-->
					</div>
					<!--end::Wrapper-->

					<!--begin::Button-->
					<a href="#" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_create_app" id="kt_toolbar_primary_button">
						Create
					</a>
					<!--end::Button-->
				</div> #}
				<!--end::Actions-->
			</div>
			<!--end::Container-->
		</div>
		<!--end::Toolbar-->

		<!--begin::Post-->
		<div
			class="post d-flex flex-column-fluid" id="kt_post">
			<!--begin::Container-->
			<div
				id="kt_content_container" class=" container-xxl ">

				<!--begin::Category-->
				<div
					class="card card-flush">
					<!--begin::Card header-->
					<div
						class="card-header align-items-center py-5 gap-2 gap-md-5">
						<!--begin::Card title-->
						<div
							class="card-title">
							<!--begin::Search-->
							<div class="d-flex align-items-center position-relative my-1">
								<i class="ki-duotone ki-magnifier fs-3 position-absolute ms-4">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
								<input type="text" data-kt-ecommerce-category-filter="search" class="form-control form-control-solid w-250px ps-12" placeholder="Rechercher une catégorie"/>
							</div>
							<!--end::Search-->
						</div>
						<!--end::Card title-->

						<!--begin::Card toolbar-->
						<div
							class="card-toolbar">
							<!--begin::Add customer-->
							<a href="javascript:;" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#kt_modal_add_categ">
								Ajouter une catégorie
							</a>
							<!--end::Add customer-->
						</div>
						<!--end::Card toolbar-->
					</div>
					<!--end::Card header-->

					<!--begin::Card body-->
					<div
						class="card-body pt-0">

						<!--begin::Table-->
						<table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_ecommerce_category_table">
							<thead>
								<tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
									<th class="w-10px pe-2">
										<div class="form-check form-check-sm form-check-custom form-check-solid me-3">
											<input class="form-check-input" type="checkbox" data-kt-check="true" data-kt-check-target="#kt_ecommerce_category_table .form-check-input" value="1"/>
										</div>
									</th>
									<th class="min-w-250px">Catégorie</th>
									<th class="min-w-150px">Type</th>
									<th class="text-end min-w-70px">Actions</th>
								</tr>
							</thead>
							<tbody class="fw-semibold text-gray-600">
                                {% for categorie in categories %}
								<tr>
									<td>
										<div class="form-check form-check-sm form-check-custom form-check-solid">
											<input class="form-check-input" type="checkbox" value="{{categorie.id}}"/>
										</div>
									</td>
									<td>
										<div
											class="d-flex">
											<!--begin::Thumbnail-->
											<a href="javascript:;" class="symbol symbol-50px" data-bs-toggle="modal" data-bs-target="#kt_modal_edit_categ">
												<span class="symbol-label" style="background-image:url({{asset('assets/media/svg/files/blank-image.svg')}});"></span>
											</a>
											<!--end::Thumbnail-->

											<div
												class="ms-5">
												<!--begin::Title-->
												<a href="javascript:;" class="text-gray-800 text-hover-primary fs-5 fw-bold mb-1" data-kt-ecommerce-category-filter="category_name" data-bs-toggle="modal" data-bs-target="#kt_modal_edit_categ">{{categorie.libelle}}</a>
												<!--end::Title-->

												<!--begin::Description-->
												<div class="text-muted fs-7 fw-bold">{{categorie.description ? categorie.description|raw : 'Our computers and tablets include all the big brands.'}}</div>
												<!--end::Description-->
											</div>
										</div>
									</td>
									<td>
										<!--begin::Badges-->
										<div class="badge badge-light-{{categorie.couleur|lower}}">{{categorie.couleur}}</div>
										<!--end::Badges-->
									</td>
									<td class="text-end">
										<a href="#" class="btn btn-sm btn-light btn-active-light-primary btn-flex btn-center" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
											Actions
											<i class="ki-duotone ki-down fs-5 ms-1"></i>
										</a>
										<!--begin::Menu-->
										<div
											class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">
											<!--begin::Menu item-->
											<div class="menu-item px-3">
												<a href="javascript:;" class="menu-link px-3" data-bs-toggle="modal" data-bs-target="#kt_modal_edit_categ">
													Modifier
												</a>
											</div>
											<!--end::Menu item-->

											<!--begin::Menu item-->
											<form class="menu-item px-3" method="post" action="{{ path('categorie_delete', {'categorie': categorie.id}) }}">
                                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ categorie.id) }}">
                                                <a href="#" class="menu-link px-3" data-kt-ecommerce-category-filter="delete_row">
                                                    Supprimer
                                                </a>
                                            </form>
											<!--end::Menu item-->
										</div>
										<!--end::Menu-->
									</td>
								</tr>
                                {% endfor %}
							</tbody>
							<!--end::Table body-->
						</table>
						<!--end::Table-->
					</div>
					<!--end::Card body-->
				</div>
				<!--end::Category-->
			</div>
			<!--end::Container-->
		</div>
		<!--end::Post-->

		<!--begin::Modals-->
        <!--begin::Modal - Add Categorie-->
        <div
            class="modal fade" id="kt_modal_add_categ" tabindex="-1" aria-hidden="true"> <!--begin::Modal dialog-->
            <div
                class="modal-dialog modal-dialog-centered modal-lg">
                <!--begin::Modal content-->
                <div
                    class="modal-content">
                    <!--begin::Form-->
                    {{ form_start(new_categ, {'attr': {'id': 'kt_modal_add_categ_form', 'class': 'form'}}) }}

                        <!--begin::Modal header-->
                        <div
                            class="modal-header" id="kt_modal_add_categ_header">
                            <!--begin::Modal title-->
                            <h2 class="fw-bold">Ajouter une catégorie</h2>
                            <!--end::Modal title-->

                            <!--begin::Close-->
                            <div id="kt_modal_add_categ_close" class="btn btn-icon btn-sm btn-active-icon-primary">
                                <i class="ki-duotone ki-cross fs-1">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                            </div>
                            <!--end::Close-->
                        </div>
                        <!--end::Modal header-->

                        <!--begin::Modal body-->
                        <div
                            class="modal-body py-10 px-lg-17">
                            <!--begin::Scroll-->
                            <div
                                class="scroll-y me-n7 pe-7" id="kt_modal_add_categ_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_add_categ_header" data-kt-scroll-wrappers="#kt_modal_add_categ_scroll" data-kt-scroll-offset="300px">
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Libellé</span>
                                    </label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    {{ form_widget(new_categ.libelle, {'attr': {'class': 'form-control form-control-solid', 'placeholder': 'Entrer un libellé'}}) }}
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-10">
                                    <!--begin::Label-->
                                    <label class="fs-5 fw-bold form-label mb-2">
                                        <span class="required">Type</span>
                                    </label>
                                    <!--end::Label-->

                                    <!--begin::Radio group-->
                                    <div class="btn-group w-100" data-kt-buttons="true" data-kt-buttons-target="[data-kt-button]">
                                        {% for choice in new_categ.couleur %}
                                        <!--begin::Radio-->
                                        <label class="btn btn-outline btn-color-muted btn-active-{{ choice.vars.value }} {{ choice.vars.checked ? 'active' : '' }}" data-kt-button="true">
                                            <!--begin::Input-->
                                            {{ form_widget(choice) }}
                                            <!--end::Input-->
                                            {{ choice.vars.label }}
                                        </label>
                                        <!--end::Radio-->
                                        {% endfor %}
                                    </div>
                                    <!--end::Radio group-->
                                </div>
                                <!--end::Input group-->
                                
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-15">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold mb-2">Description</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    {{form_widget(new_categ.description, {'attr': {'class': 'form-control form-control-solid', 'placeholder': ''}})}}
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->

                            </div>
                            <!--end::Scroll-->
                        </div>
                        <!--end::Modal body-->

                        <!--begin::Modal footer-->
                        <div
                            class="modal-footer flex-center">
                            <!--begin::Button-->
                            <button type="reset" id="kt_modal_add_categ_cancel" class="btn btn-light me-3">
                                Annuler
                            </button>
                            <!--end::Button-->

                            <!--begin::Button-->
                            <button type="submit" id="kt_modal_add_categ_submit" class="btn btn-primary">
                                <span class="indicator-label">
                                    Soumettre
                                </span>
                                <span class="indicator-progress">
                                    Veuillez patienter...
                                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span>
                            </button>
                            <!--end::Button-->
                        </div>
                        <!--end::Modal footer-->
                    {{ form_end(new_categ) }}
                    <!--end::Form-->
                </div>
            </div>
        </div>
        <!--end::Modal - Categorie - Add-->

        <!--begin::Modal - Edit Parametre-->
        <div
            class="modal fade" id="kt_modal_edit_categ" tabindex="-1" aria-hidden="true"> 
            <!--begin::Modal dialog-->
            <div
                class="modal-dialog modal-dialog-centered modal-lg">
                <!--begin::Modal content-->
                <div
                    class="modal-content">
                    <!--begin::Form-->
                    <form id="kt_modal_edit_categ_form" class="form" method="POST" action="{{path('edit_categorie')}}">

                        <!--begin::Modal header-->
                        <div
                            class="modal-header" id="kt_modal_edit_categ_header">
                            <!--begin::Modal title-->
                            <h2 class="fw-bold">Modifier une catégorie</h2>
                            <!--end::Modal title-->

                            <!--begin::Close-->
                            <div id="kt_modal_edit_categ_close" class="btn btn-icon btn-sm btn-active-icon-primary">
                                <i class="ki-duotone ki-cross fs-1">
                                    <span class="path1"></span>
                                    <span class="path2"></span>
                                </i>
                            </div>
                            <!--end::Close-->
                        </div>
                        <!--end::Modal header-->

                        <!--begin::Modal body-->
                        <div
                            class="modal-body py-10 px-lg-17">
                            <!--begin::Scroll-->
                            <div
                                class="scroll-y me-n7 pe-7" id="kt_modal_edit_categ_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_edit_categ_header" data-kt-scroll-wrappers="#kt_modal_edit_categ_scroll" data-kt-scroll-offset="300px">
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-7">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold form-label mb-2">
                                        <span class="required">Libellé</span>
                                    </label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <input type="hidden" name="categ_id">
                                    <input type="text" name="categ_libelle" class="form-control form-control-solid" placeholder="Entrer un libellé">
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-10">
                                    <!--begin::Label-->
                                    <label class="fs-5 fw-bold form-label mb-2">
                                        <span class="required">Type</span>
                                    </label>
                                    <!--end::Label-->

                                    <!--begin::Radio group-->
                                    <div class="btn-group w-100" data-kt-buttons="true" data-kt-buttons-target="[data-kt-edit-button]">
                                        
                                    </div>
                                    <!--end::Radio group-->
                                </div>
                                <!--end::Input group-->
                                
                                <!--begin::Input group-->
                                <div
                                    class="fv-row mb-15">
                                    <!--begin::Label-->
                                    <label class="fs-6 fw-semibold mb-2">Description</label>
                                    <!--end::Label-->

                                    <!--begin::Input-->
                                    <textarea name="categ_description" class="form-control form-control-solid" placeholder=""></textarea>
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->

                            </div>
                            <!--end::Scroll-->
                        </div>
                        <!--end::Modal body-->

                        <!--begin::Modal footer-->
                        <div
                            class="modal-footer flex-center">
                            <!--begin::Button-->
                            <button type="reset" id="kt_modal_edit_categ_cancel" class="btn btn-light me-3">
                                Annuler
                            </button>
                            <!--end::Button-->

                            <!--begin::Button-->
                            <button type="submit" id="kt_modal_edit_categ_submit" class="btn btn-primary">
                                <span class="indicator-label">
                                    Soumettre
                                </span>
                                <span class="indicator-progress">
                                    Veuillez patienter...
                                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span>
                            </button>
                            <!--end::Button-->
                        </div>
                        <!--end::Modal footer-->
                    </form>
                    <!--end::Form-->
                </div>
            </div>
        </div>
        <!--end::Modal - Categorie - Edit-->
		<!--end::Modals-->
	</div>
{% endblock %}

{% block scripts %}
    <!--begin::Vendors Javascript(used for this page only)-->
    <script src="{{asset('assets/plugins/custom/datatables/datatables.bundle.js')}}"></script>
    <!--end::Vendors Javascript-->
    <!--begin::Custom Javascript(used for this page only)-->
    <script src="{{asset('assets/js/custom/apps/ecommerce/catalog/categories.js')}}"></script>
    <script src="{{asset('assets/js/custom/apps/ecommerce/catalog/add-category.js')}}"></script>
    <script src="{{asset('assets/js/custom/apps/ecommerce/catalog/update-category.js')}}"></script>
    <!--end::Custom Javascript-->
    
    <script type="text/javascript">
        const couleurs = {{ {
            'success': 'Success',
            'primary': 'Primary',
            'secondary': 'Secondary',
            'info': 'Info',
            'warning': 'Warning',
            'danger': 'Danger'
        } | json_encode|raw }};

        const categories = {{ categories|map(c => {
            id: c.id,
            libelle: c.libelle,
            description: c.description,
            couleur: c.couleur
        })|json_encode|raw }};

        const editModal = document.getElementById('kt_modal_edit_categ');

        editModal.addEventListener('show.bs.modal', event => {
            const paramId = event.relatedTarget.closest('tr').querySelector('input.form-check-input').value;
            const categorie = categories.find(c => c.id == paramId);
            if (!categorie) return;

            editModal.querySelector('input[name="categ_id"]').value = categorie.id;
            editModal.querySelector('input[name="categ_libelle"]').value = categorie.libelle;
            editModal.querySelector('textarea[name="categ_description"]').value = categorie.description;

            const radioGroup = Object.entries(couleurs).map(([key, label]) => {
                const activeClass = categorie.couleur === key ? 'active' : '';
                const checked = categorie.couleur === key ? 'checked' : '';
                return `
                    <label class="btn btn-outline btn-color-muted btn-active-${key} ${activeClass}" data-kt-edit-button="true">
                        <input class="btn-check" type="radio" name="categ_couleur" value="${key}" ${checked} />
                        ${label}
                    </label>
                `;
            }).join('');

            editModal.querySelector('[data-kt-buttons="true"]').innerHTML = `
                ${radioGroup}
            `;
        });

        {% for type, messages in app.flashes %}
            {% for message in messages %}
            Swal.fire({
                html: `{{message|raw}}`,
                icon: "{{type}}",
                buttonsStyling: false,
                confirmButtonText: "Ok, compris !",
                customClass: {
                    confirmButton: "btn btn-primary"
                }
            });
            {% endfor %}
        {% endfor %}
    </script>
{% endblock %}
